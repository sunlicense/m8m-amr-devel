<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Autonomous Transporter</title>
<style type="text/css" media="screen">
body { background: #e7e7e7; font-family: Verdana, sans-serif; font-size: 10pt; }
#page { background: #ffffff; margin: 5px; border: 2px solid #c0c0c0; padding: 5px; }
#header { background: #4b6983; border: 2px solid #7590ae; text-align: center; padding: 2px; color: #ffffff; }
#header h1 { color: #ffffff; }
#body { padding: 5px; }
span.tt { font-family: monospace; }
span.bold { font-weight: bold; }
a:link { text-decoration: none; font-weight: bold; color: #C00; background: #ffc; }
a:visited { text-decoration: none; font-weight: bold; color: #999; background: #ffc; }
a:active { text-decoration: none; font-weight: bold; color: #F00; background: #FC0; }
a:hover { text-decoration: none; color: #C00; background: #FC0; }
button { border:5px solid black; color:#f00; background:#ccc; padding: 5px}
#table {text-align: center;padding: 1px}
table, th, td {
  border: 2px solid black;
  border-collapse: collapse;
}
th {
  text-align: center;
}
td {
  text-align: center;
}
</style>
</head>
<body onload="start()">
<div id="page">
 <div id="header">
 <h4> DashBoard</h4>
  
 </div>
 <div id="body">
	<table border="1" style="width:100%">		
	<tr>
		<td style="height:15px;width:60px;padding:1px;text-align:left;color:#f00;font-size:10pt">Alarm</td>
		<td id="alarm" style="height:15px;padding:2px;text-align:centre;font-size: 10pt"></td>
	</tr>
	</table>
	<br>
  <table border="1" style="width:100%">
	<tr>		
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Runtime-H:mm</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Downtime-H:mm/td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Idletime-H:mm</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Triptime-H:mm</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Num of Trips</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Voltage-V</td>
	</tr>

	<tr>		
		<td id="runtime" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="downtime" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="idletime" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="triptime" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="tnumtrip" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="voltage" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
	</tr>

	<!--tr>		
		<td style="height:15px;width:140px;padding:1px;text-align:centre;color:#00f;font-size:10pt">Tot Runtime(min)</td>
		<td id="runtime" style="height:15px;width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:centre;color:#00f;font-size:10pt">Tot Downtime(min)</td>
		<td id="downtime" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:centre;color:#00f;font-size:10pt">Tot Idletime(min)</td>
		<td id="idletime" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:centre;color:#00f;font-size:10pt">Tot Triptime(min)</td>
		<td id="triptime" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:centre;color:#00f;font-size:10pt">Total Num Trip</td>
		<td id="tnumtrip" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
	</tr-->
	
	<!--tr>		
		<td style="height:15px;width:140px;padding:1px;text-align:left;color:#00f;font-size:10pt">Voltage</td>
		<td id="voltage" style="height:15px;width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:left;color:#00f;font-size:10pt">Current</td>
		<td id="current" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:left;color:#00f;font-size:10pt">Battery(%)</td>
		<td id="batlevel" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:left;color:#00f;font-size:10pt">Bat Uptime(hr)</td>
		<td id="batuptime" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:140px;padding:2px;text-align:left;color:#00f;font-size:10pt"></td>
		<td id="xxx" style="width:100px;padding:2px;text-align:centre;font-size: 10pt"></td>
	</tr-->

	<!--tr>		
		<td style="height:15px;width:150px;padding:1px;text-align:left;color:#00f;font-size:10pt">Base Laser</td>
		<td id="baselaser" style="height:15px;width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:150px;padding:2px;text-align:left;color:#00f;font-size:10pt">Centre Laser</td>
		<td id="centrelaser" style="width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:150px;padding:2px;text-align:left;color:#00f;font-size:10pt">Left Laser</td>
		<td id="leftlaser" style="width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:150px;padding:2px;text-align:left;color:#00f;font-size:10pt">Right Laser</td>
		<td id="rightlaser" style="width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
	</tr-->

	<!--tr>		
		<td style="height:15px;width:150px;padding:1px;text-align:left;color:#00f;font-size:10pt">AmpereHr</td>
		<td id="amphr" style="height:15px;width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td style="height:15px;width:150px;padding:1px;text-align:left;color:#00f;font-size:10pt">Motor</td>
		<td id="motor" style="height:15px;width:150px;padding:2px;text-align:centre;font-size: 10pt"></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr-->
  </table> 
	<br>
	<table border="1" style="width:100%">
	<tr>				
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Current-A</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Battery Level-%</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Battery Uptime-hr</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Linear Speed-m/s</td>
		<td style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt">Angular Speed-r/s</td>
		<td rowspan="2" style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt"><button style="height:70px;width:120px;padding:2px" onclick="location.href=`index.html`;"><h2>Main</h2></button></td>
	</tr>

	<tr>				
		<td id="current" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="batlevel" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="batuptime" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="linear" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<td id="angular" style="height:30px;width:140px;padding:1px;color:#A52A2A;font-size:12pt"></td>
		<!--td id="tnumtrip" style="height:30px;width:140px;padding:1px;color:#00f;font-size:12pt"></td-->
	</tr>
	</table>			
 </div>
</div>
<script type="text/javascript" src="js/easeljs.js"></script>
<script type="text/javascript" src="js/eventemitter2.js"></script>
<script type="text/javascript" src="js/roslib.js"></script>
<script type="text/javascript" src="js/ros2d.js"></script>
<script type="text/javascript" src="js/nav2d.js"></script>

<script type="text/javascript" type="text/javascript">
//var hostIP = "ws://"+location.host+":8080";
var hostIP = "ws://192.168.1.120:8080";
var ros = new ROSLIB.Ros();
ros.connect(hostIP);

var PM = new ROSLIB.Param({
    ros : ros,
    name : 'mapflag'
});


var statlistener = new ROSLIB.Topic({
    ros : ros,
    name : '/stat',
    messageType : 'htbot/stat'
  });

statlistener.subscribe(function(message) {
	var v1,v2,v3,v4;
	v3 = message.totalruntime;
	v2 = v3 / 60.0;
	v2 = parseInt(v2);
	v1 = v3 - v2*60.0;
	v1 = parseInt(v1);
	v4 = v2.toString();
	v5 = v1.toString();
	v4 = v4 + " : "+v5;
  //document.getElementById("runtime").innerHTML = message.totalruntime.toFixed(2) ;
	document.getElementById("runtime").innerHTML = v4 ;

	v3 = message.totaldowntime;
	v2 = v3 / 60.0;
	v2 = parseInt(v2);
	v1 = v3 - v2*60.0;
	v1 = parseInt(v1);
	v4 = v2.toString();
	v5 = v1.toString();
	v4 = v4 + " : "+v5;	
	document.getElementById("downtime").innerHTML = v4 ;

	v3 = message.totalidletime;
	v2 = v3 / 60.0;
	v2 = parseInt(v2);
	v1 = v3 - v2*60.0;
	v1 = parseInt(v1);
	v4 = v2.toString();
	v5 = v1.toString();
	v4 = v4 + " - "+v5;	
	document.getElementById("idletime").innerHTML = v4 ;

	v3 = message.totaltriptime;
	v2 = v3 / 60.0;
	v2 = parseInt(v2);
	v1 = v3 - v2*60.0;
	v1 = parseInt(v1);
	v4 = v2.toString();
	v5 = v1.toString();
	v4 = v4 + " : "+v5;	
	document.getElementById("triptime").innerHTML = v4 ;

	document.getElementById("voltage").innerHTML = message.avgvolt.toFixed(2) ;
	document.getElementById("current").innerHTML = message.avgcurr.toFixed(2) ;
	document.getElementById("batlevel").innerHTML = message.batlevel.toFixed(2) ;
	document.getElementById("batuptime").innerHTML = message.uptime.toFixed(2) ;
	document.getElementById("tnumtrip").innerHTML = message.tnumtrip ;
	//if (message.laserfront == 1) {
  //  document.getElementById("baselaser").innerHTML = "ON";
	//} else {
	//	if (message.laserfront == 0) {
	//		document.getElementById("baselaser").innerHTML = "OFF";
	//	} else {
	//		document.getElementById("baselaser").innerHTML = "NOT USED";
	//	}
	//}
	//if (message.lasercenter == 1) {
  //  document.getElementById("centrelaser").innerHTML = "ON";
	//} else {
	//	if (message.lasercenter == 0) {
	//		document.getElementById("centrelaser").innerHTML = "OFF";
	//	} else {
	//		document.getElementById("centrelaser").innerHTML = "NOT USED";
	//	}
	//}
	//if (message.laserleft == 1) {
  //  document.getElementById("leftlaser").innerHTML = "ON";
	//} else {
	//	if (message.laserleft == 0) {
	//		document.getElementById("leftlaser").innerHTML = "OFF";
	//	} else {
	//		document.getElementById("leftlaser").innerHTML = "NOT USED";
	//	}
	//}
	//if (message.laserright == 1) {
  //  document.getElementById("rightlaser").innerHTML = "ON";
	//} else {
	//	if (message.laserright == 0) {
	//		document.getElementById("rightlaser").innerHTML = "OFF";
	//	} else {
	//		document.getElementById("rightlaser").innerHTML = "NOT USED";
	//	}
	//}
	//document.getElementById("amphr").innerHTML = message.amphr.toFixed(2) ;
	//if (message.motorstatus == 1) {
  //  document.getElementById("motorstatus").innerHTML = "ERROR";
	//} else {
	//	if (message.motorstatus == 0) {
	//		document.getElementById("motor").innerHTML = "OK";
	//	} 
	//}
});

var cmdvellistener = new ROSLIB.Topic({
    ros : ros,
    name : '/speed',
    messageType : 'htbot/stat_speed'
  });

cmdvellistener.subscribe(function(message) {
  document.getElementById("linear").innerHTML = message.linear.toFixed(2) ;
	document.getElementById("angular").innerHTML = message.angular.toFixed(2) ;
});


function start() {
	//ros.connect("ws://192.168.1.122:8080");
	ros.on('error', function(error) {
		document.getElementById("alarm").innerHTML = "Robot Not Ready. Please Wait..." ;    
		document.getElementById("alarm").style.color = "red";
  });
	var status;
	PM.name = 'RobotReady';
	PM.get(function(value) {
    console.log('RobotReady: ' + value);		
		if (value == 77) {
			document.getElementById("alarm").innerHTML = "Robot Ready." ;    
			document.getElementById("alarm").style.color = "green";
		} else if (value == 88) {
			document.getElementById("alarm").innerHTML = "Robot Ready." ;    
			document.getElementById("alarm").style.color = "green";	
		} else {
			document.getElementById("alarm").innerHTML = "Robot Not Ready." ;    
			document.getElementById("alarm").style.color = "red";
		}
  });
	
}


</script>
</body>
</html>
